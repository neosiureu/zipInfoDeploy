<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zipinfo.project.myPage.model.mapper.MyPageMapper">

	<select id="getMemberInfo">
		SELECT MEMBER_NO, MEMBER_NAME, MEMBER_NICKNAME, MEMBER_EMAIL, MEMBER_AUTH, MEMBER_LOCATION <if test="memberAuth eq 3">, COMPANY_NAME, COMPANY_LOCATION, PRESIDENT_NAME, BROKER_NO, PRESIDENT_PHONE</if>
		FROM MEMBER M
		<if test="memberAuth eq 3">
		JOIN BROKER_INFO B USING(MEMBER_NO)
		</if>
		WHERE MEMBER_NO = #{memberNo}
	</select>

	<update id="updateNormalInfo">
		UPDATE "MEMBER" SET
		MEMBER_NICKNAME = #{memberNickname}
		WHERE MEMBER_NO = #{memberNo}
	</update>

	<update id="updateBrokerInfo">
		UPDATE "BROKER_INFO" SET
		COMPANY_NAME = #{companyName},
		COMPANY_LOCATION = #{companyLocation},
		PRESIDENT_NAME = #{presidentName},
		BROKER_NO = #{brokerNo},
		PRESIDENT_PHONE = #{presidentPhone}
		WHERE MEMBER_NO = #{memberNo}
	</update>
	
	<select id="getMemberPassword">
		SELECT MEMBER_PW FROM "MEMBER"
		WHERE MEMBER_NO = #{memberNo}
	</select>
	
	<update id="updatePassword">
		UPDATE "MEMBER" SET
		MEMBER_PW = #{memberPw}
		WHERE MEMBER_NO = #{memberNo}
	</update>
	
	<select id="checkNickname" resultType="java.lang.Integer">
		SELECT MEMBER_NO
		FROM "MEMBER"
		WHERE MEMBER_NICKNAME = #{memberNickname}
	</select>
	
	<select id="compareInfo">
		SELECT COMPANY_NAME, COMPANY_LOCATION, PRESIDENT_NAME, BROKER_NO, PRESIDENT_PHONE
		FROM "BROKER_INFO"
		WHERE MEMBER_NO = #{memberNo}
	</select>
	
	<update id="changeAuth">
		UPDATE "MEMBER" SET
		MEMBER_AUTH = 2
		WHERE MEMBER_NO = #{memberNo}
	</update>
	
	<update id="withDraw">
		UPDATE "MEMBER" SET
		MEMBER_DEL_FL = 'Y'
		WHERE MEMBER_NO = #{memberNo}
	</update>
	
	<insert id="addStock">
		INSERT INTO "STOCK_INFO"
		VALUES(SEQ_STOCK_INFO.NEXTVAL, #{memberNo}, #{stockName}, #{stockSellPrice}, #{stockManageFee}
		, #{stockFeeMonth}, #{stockInfo}, #{stockType}, #{stockForm}, #{exclusiveArea}, #{supplyArea}
		, #{currentFloor}, #{floorTotalCount}, #{roomCount}, #{bathCount}, #{stockDirection}, #{ableDate}
		, #{useApprovalDate}, #{registDate}, #{stockDetail}, #{stockAddress}, #{regionNo}, 'N')
	</insert>
	
	<insert id="addStockImg">
		INSERT INTO "STOCK_IMG"
		VALUES(SEQ_STOCK_IMG.NEXTVAL, #{stockNo}, #{i}, #{finalPath}, #{originalName}, #{rename})
	</insert>
	
	<select id="searchStockNo">
		SELECT STOCK_NO
		FROM (
 		   SELECT STOCK_NO
		    FROM STOCK_INFO
		    WHERE MEMBER_NO = #{memberNo}
		    ORDER BY STOCK_NO DESC
		)
		WHERE ROWNUM = 1
	</select>
	
	<insert id="addCoord">
		INSERT INTO "STOCK_COORD"
		VALUES(#{stockNo}, #{lat}, #{lng})
	</insert>
	
	<select id="getMyStock">
		SELECT * FROM "STOCK_INFO"
		WHERE MEMBER_NO = #{memberNo}
		ORDER BY STOCK_NO DESC
	</select>
	
	<select id="selectImgUrl">
		SELECT IMG_URL, IMG_ORIGIN_NAME FROM "STOCK_IMG"
		WHERE STOCK_NO = #{stockNo}
		ORDER BY IMG_ORDER
	</select>
	
	<select id="selectStockCoord">
		SELECT * FROM "STOCK_COORD"
		WHERE STOCK_NO = #{stockNo}
	</select>
	
	<delete id="deleteStockInfo">
		DELETE "STOCK_INFO"
		WHERE STOCK_NO = #{stockNo}
	</delete>
</mapper>
