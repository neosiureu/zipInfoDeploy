<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zipinfo.project.neighborhood.model.mapper.NeighborhoodMapper">
<!--  게시글 수 조회  -->
	<select id="getListCount">
		SELECT COUNT(*)
		FROM "BOARD" B 
		JOIN "MEMBER" M ON B.MEMBER_NO = M.MEMBER_NO
		WHERE BOARD_DEL_FL = 'N'
		AND M.MEMBER_DEL_FL ='N'

	</select>
	
	<!-- 특정 게시판의 지정된 페이지 목록 조회 -->
<select id="selectBoardList" >
    SELECT
        B.BOARD_NO,
        B.BOARD_TITLE,
        M.MEMBER_NICKNAME,
        B.READ_COUNT,
        B.BOARD_CONTENT,
        B.BOARD_SUBJECT AS boardSubject,   
        B.MEMBER_NO AS memberNo,      
        B.TOWN_NO AS townNo,
        M.MEMBER_NICKNAME,

        (
  SELECT COUNT(DISTINCT CL.COMMENT_NO)
    FROM "COMMENT"       C
    JOIN "COMMENT_LIKE" CL ON CL.COMMENT_NO = C.COMMENT_NO
   WHERE C.BOARD_NO       = B.BOARD_NO      
     AND C.COMMENT_DEL_FL = 'N'             
) AS COMMENT_COUNT,

        (SELECT COUNT(*)
           FROM "LIKE" L
          WHERE L.BOARD_NO = B.BOARD_NO) AS LIKE_COUNT,

        (SELECT BT.TOWN_NAME
           FROM "BOARD_TOWN" BT
          WHERE BT.TOWN_NO = B.TOWN_NO) AS TOWN_NAME,

        (SELECT BC.CITY_NAME
           FROM "BOARD_CITY" BC
          WHERE BC.CITY_NO = (
                SELECT BT.CITY_NO
                  FROM "BOARD_TOWN" BT
                 WHERE BT.TOWN_NO = B.TOWN_NO
           ))  AS CITY_NAME,
           (SELECT BC.CITY_NO                              
           FROM "BOARD_CITY" BC
          WHERE BC.CITY_NO = (
                SELECT BT.CITY_NO
                
                  FROM "BOARD_TOWN" BT
                 WHERE BT.TOWN_NO = B.TOWN_NO))        AS CITY_NO,
        <![CDATA[
        CASE 
          WHEN SYSDATE - B.BOARD_WRITE_DATE < 1/24/60  THEN FLOOR((SYSDATE - B.BOARD_WRITE_DATE)*24*60*60) || '초 전'
          WHEN SYSDATE - B.BOARD_WRITE_DATE < 1/24     THEN FLOOR((SYSDATE - B.BOARD_WRITE_DATE)*24*60)    || '분 전'
          WHEN SYSDATE - B.BOARD_WRITE_DATE < 1        THEN FLOOR((SYSDATE - B.BOARD_WRITE_DATE)*24)       || '시간 전'
          WHEN SYSDATE - B.BOARD_WRITE_DATE < 30       THEN FLOOR( SYSDATE - B.BOARD_WRITE_DATE)           || '일 전'
          WHEN SYSDATE - B.BOARD_WRITE_DATE < 365      THEN FLOOR((SYSDATE - B.BOARD_WRITE_DATE)/30)       || '달 전'
          ELSE  FLOOR((SYSDATE - B.BOARD_WRITE_DATE)/365)                                                 || '년 전'
        END
        ]]>                                         AS BOARD_WRITE_DATE

    FROM "BOARD"  B
    JOIN "MEMBER" M ON B.MEMBER_NO = M.MEMBER_NO

    WHERE B.BOARD_DEL_FL  = 'N'
      AND M.MEMBER_DEL_FL = 'N'

    ORDER BY B.BOARD_NO DESC
</select>


 
</mapper>
